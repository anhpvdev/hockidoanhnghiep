<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../../../public/Scripts/jquery.js"></script>
    <style>
        .img_pr{
            width: 200px;
            height: auto;
        }
        h1{
            color: red;
        }
    </style>
</head>
<body>
    <h1><%= data[0].prname %></h1>
    <% for(var i = 0; i < image.length; i++) { %>
        <img class="img_pr" src="/public/images/Products/<%= image[i].image %>" alt="">
      <% } %> 
    <div></div>
    <h3>Phân Loại</h3>
    <div>
        <% for(var i = 0; i < data.length; i++) { %>
            <button id="<%= data[i].Classify_type_id%>" style="color: #9e9e9e;" onclick="changetype(this)"  value="<%= data[i].Prices%>"><%= data[i].Name %> - <%=data[i].clname %></button>
          <% } %> 
        <div>-----</div>
        <div style="display: flex;"><button id="num_dow">-</button> <input id="num_add" type="text" value="1"> <button id="num_up">+</button></div>
        <div class="price"></div>
        <div>-----</div>
        <button id="buy_cart">mua hàng</button>
    </div>
    <script>
        var last_call
        function changetype(node){
            if(last_call) last_call.style.color = "#9e9e9e"
            node.style.color = "black"
            last_call = node
            let price = parseInt(node.value) * parseInt(numadd.value)
            document.querySelector(".price").innerHTML = price +" VND"
        }

        const numadd = document.getElementById("num_add")
        const numup = document.getElementById("num_up")
        const numdow = document.getElementById("num_dow")
        const buycart = document.getElementById("buy_cart")
        numup.onclick = function(){
            numadd.value = parseInt(numadd.value) + 1
            let price = parseInt(last_call.value) * parseInt(numadd.value)
            document.querySelector(".price").innerHTML = price +" VND"
        }
        numdow.onclick = function(){
            if(numadd.value>=1){
                numadd.value = parseInt(numadd.value) - 1
                let price = parseInt(last_call.value) * parseInt(numadd.value)
                document.querySelector(".price").innerHTML = price +" VND"
            }
        }

        buycart.onclick = function(){
            $.ajax({
                url: '/buyer/buy',
                type: 'POST',
                data:{
                    product: last_call.id,
                    num: numadd.value
                },
                success: function(data) {
                    console.log(data.success)
                    if(data.success){
                       alert(data.data)
                    }else{
                        alert(data.data)
                        window.location.reload()
                    }
                }
            });
        }
    </script>
</body>
</html>